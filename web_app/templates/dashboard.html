<!-- FILE: web_app/templates/dashboard.html (Upgraded) -->
{% extends "base.html" %}
{% block content %}

<h2>ğŸ“Š Home Dashboard</h2>

<!-- LIVE STATUS CARD -->
<div class="card">
  <h3>ğŸ“¡ Live System Status</h3>
  <div class="live-grid">
    <div>
      <h4>ğŸŒ¡ï¸ Temperature</h4>
      <p class="live-value">{{ live_data.temperature if live_data else 'â€”' }}Â°C</p>
    </div>
    <div>
      <h4>ğŸ’§ Humidity</h4>
      <p class="live-value">{{ live_data.humidity if live_data else 'â€”' }}%</p>
    </div>
    <div>
      <h4>ğŸš¨ Motion</h4>
      <p class="live-value motion {{ 'active' if live_data.motion == '1' else '' }}">
        {{ 'ğŸ”´ YES' if live_data.motion == '1' else 'ğŸŸ¢ NO' }}
      </p>
    </div>
  </div>

  <button id="refresh-btn" class="btn-enable" style="margin-top: 10px;">ğŸ”„ Refresh Now</button>
</div>

<!-- DEVICE STATES -->
<div class="card">
  <h3>ğŸ›ï¸ Device Status</h3>
  <div class="device-state-grid">
    <div class="device-state {{ 'on' if device_states['led_status'] == '1' else 'off' }}">
      <h4>ğŸ’¡ LED</h4>
      <p>{{ 'ğŸŸ¢ ON' if device_states['led_status'] == '1' else 'ğŸ”´ OFF' }}</p>
    </div>
    <div class="device-state {{ 'on' if device_states['buzzer_status'] == '1' else 'off' }}">
      <h4>ğŸ”” Buzzer</h4>
      <p>{{ 'ğŸŸ¢ ON' if device_states['buzzer_status'] == '1' else 'ğŸ”´ OFF' }}</p>
    </div>
    <div class="device-state {{ 'on' if device_states['motor_status'] == '1' else 'off' }}">
      <h4>ğŸ”§ Motor</h4>
      <p>{{ 'ğŸŸ¢ ON' if device_states['motor_status'] == '1' else 'ğŸ”´ OFF' }}</p>
    </div>
  </div>
</div>

<!-- RECENT ENV DATA -->
<div class="card">
  <h3>ğŸ—“ï¸ Recent Environment Readings</h3>

  {% if latest_env %}
  <table>
    <tr>
      <th>Time</th>
      <th>Temp (Â°C)</th>
      <th>Humidity (%)</th>
    </tr>
    {% for row in latest_env %}
    <tr>
      <td>{{ row.timestamp }}</td>
      <td>{{ row.temperature }}</td>
      <td>{{ row.humidity }}</td>
    </tr>
    {% endfor %}
  </table>
  {% else %}
  <p>No environment data recorded yet.</p>
  {% endif %}
</div>

<!-- SYNC STATUS -->
<div class="card">
  <h3>â˜ï¸ Cloud Sync</h3>
  <p>Pending entries: <strong>{{ sync_pending }}</strong></p>
</div>

<script>
  document.getElementById("refresh-btn").addEventListener("click", async () => {
    try {
      const res = await fetch("/api/live-data");
      const data = await res.json();
      location.reload();
    } catch (e) {
      console.error("Live update failed", e);
    }
  });
</script>

{% endblock %}