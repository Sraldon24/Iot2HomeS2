{% extends "base.html" %}
{% block content %}

<h2>ğŸš¨ Security System</h2>

<!-- SYSTEM ENABLE/DISABLE -->
<div class="card">
  <h3>ğŸ” System Status</h3>
  <div class="status-box {{ 'enabled' if is_enabled else 'disabled' }}">
    <div>{{ 'ğŸŸ¢' if is_enabled else 'ğŸ”´' }}</div>
    <div><strong>{{ 'ENABLED' if is_enabled else 'DISABLED' }}</strong></div>
  </div>

  <form method="POST" style="margin-top: 20px; display:flex; gap:10px;">
    <button type="submit" name="toggle_security"
            value="{{ 'disable' if is_enabled else 'enable' }}"
            class="{{ 'btn-disable' if is_enabled else 'btn-enable' }}">
      {{ 'ğŸ”’ Disable' if is_enabled else 'ğŸ”“ Enable' }}
    </button>
  </form>
</div>


<!-- INTRUSION STATS -->
<div class="card">
  <h3>ğŸ“… Intrusion Summary</h3>
  <form method="POST">
    <input type="date" name="date" value="{{ selected_date }}" required>
    <button type="submit">Load</button>
  </form>

  <p>{{ selected_date }}: <strong>{{ total_intrusions }}</strong> intrusions</p>
</div>


<!-- INTRUSION LOG TABLE -->
<div class="card">
  <h3>ğŸ“‹ Intrusion Log</h3>

  {% if intrusions %}
  <table>
    <tr>
      <th>Time</th>
      <th>Status</th>
      <th>Image</th>
    </tr>

    {% for event in intrusions %}
    <tr>
      <td>{{ event[0] }}</td>
      <td><span class="badge-danger">ğŸ”´ Motion</span></td>
      <td>
        {% if event[2] %}
          <img src="data:image/jpeg;base64,{{ event[2] }}" style="max-height:150px; border-radius:6px;" />
        {% else %}
          -
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </table>
  {% else %}
    <p>âœ… No intrusions on {{ selected_date }}.</p>
  {% endif %}
</div>

{% endblock %}