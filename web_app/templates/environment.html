{% extends "base.html" %}
{% block content %}

<h2>ğŸŒ¡ï¸ Environment Monitoring</h2>

<!-- DATE SELECTOR -->
<div class="card">
  <h3>ğŸ“… Select a Date</h3>
  <form method="POST" class="date-form">
    <input type="date" name="date" value="{{ selected_date }}" required>
    <button type="submit">Load</button>
  </form>

  {% if data_count == 0 %}
    <p class="warning">No data recorded for this date.</p>
  {% endif %}
</div>


<!-- CHART SECTION -->
{% if data_count > 0 %}
<div class="card">
  <h3>ğŸ“ˆ Temperature & Humidity</h3>
  <canvas id="envChart" width="400" height="200"></canvas>
</div>


<!-- SUMMARY SECTION -->
<div class="card">
  <h3>ğŸ“Š Daily Summary</h3>
  <p><strong>Min Temp:</strong> {{ min_temp }}Â°C</p>
  <p><strong>Max Temp:</strong> {{ max_temp }}Â°C</p>
  <p><strong>Min Humidity:</strong> {{ min_hum }}%</p>
  <p><strong>Max Humidity:</strong> {{ max_hum }}%</p>
</div>


<!-- RAW TABLE -->
<div class="card">
  <h3>ğŸ“‹ Raw Data</h3>
  <table>
    <tr>
      <th>Time</th>
      <th>Temp (Â°C)</th>
      <th>Humidity (%)</th>
    </tr>
    {% for row in env_data %}
    <tr>
      <td>{{ row.timestamp }}</td>
      <td>{{ row.temperature }}</td>
      <td>{{ row.humidity }}</td>
    </tr>
    {% endfor %}
  </table>
</div>


<!-- CHART SCRIPT -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('envChart').getContext('2d');

  const chartData = {
    labels: {{ labels | safe }},
    datasets: [
      {
        label: 'Temperature (Â°C)',
        data: {{ temperatures | safe }},
        borderColor: 'rgb(255, 99, 132)',
        tension: 0.3,
        fill: false,
      },
      {
        label: 'Humidity (%)',
        data: {{ humidities | safe }},
        borderColor: 'rgb(54, 162, 235)',
        tension: 0.3,
        fill: false,
      }
    ]
  };

  new Chart(ctx, {
    type: 'line',
    data: chartData,
    options: {
      responsive: true,
      plugins: {
        legend: { labels: { color: '#eaeaea' } }
      },
      scales: {
        x: { ticks: { color: '#eaeaea' } },
        y: { ticks: { color: '#eaeaea' } }
      }
    }
  });
</script>

{% endif %}

{% endblock %}